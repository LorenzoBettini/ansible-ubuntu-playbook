---
- name: Copy Microsoft apt key
  # The apt_key file is expected to be found on the remote host
  # so we first need to copy it
  become: yes
  copy:
    src: "{{ playbook_dir }}/tasks/files/keys/microsoft.asc"
    dest: "/tmp/"

- name: Add VS apt key
  become: yes
  apt_key:
    # url: 'https://packages.microsoft.com/keys/microsoft.asc'
    # use locally save key to avoid possible temporary failures
    file: "/tmp/microsoft.asc"
    state: present

- name: Add VS Code repo (apt)
  become: yes
  apt_repository:
    repo: 'deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main'
    filename: vscode
    state: present

- name: Install VS Code (apt)
  become: yes
  apt:
    update_cache: yes
    name: code
    state: present
  register: aptout

- debug: msg="{{ aptout.stdout_lines }}"
  when: aptout.stdout_lines is defined
